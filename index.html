<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipWave - Ваши видео</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #000;
            color: white;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid #333;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
        }
        
        .section.active {
            display: flex;
        }
        
        /* Стили для ленты видео */
        .video-feed {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .video-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #111;
            display: none;
        }
        
        .video-item.active {
            display: block;
        }
        
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-controls {
            position: absolute;
            bottom: 80px;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .video-info {
            max-width: 70%;
        }
        
        .username {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        
        .video-description {
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tag {
            color: #fff;
            font-size: 0.8em;
            opacity: 0.9;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: white;
            text-align: center;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .action-icon {
            font-size: 24px;
            margin-bottom: 5px;
            transition: transform 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .action-btn:hover .action-icon {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .action-count {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .like-btn.liked .action-icon {
            color: #ff0050;
            background: rgba(255, 0, 80, 0.2);
        }
        
        /* Стили для загрузки */
        .upload-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .upload-area {
            border: 2px dashed #333;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: border-color 0.3s;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .upload-area:hover {
            border-color: #ff0050;
            background: rgba(255, 0, 80, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ff0050;
        }
        
        .upload-btn {
            background: #ff0050;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            transition: background 0.3s;
        }
        
        .upload-btn:hover {
            background: #e00045;
        }
        
        .upload-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        /* Стили для профиля */
        .profile-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .profile-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            font-weight: bold;
        }
        
        .login-form, .register-form {
            max-width: 400px;
            margin: 20px auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid #333;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #222;
            border: 1px solid #333;
            border-radius: 10px;
            color: white;
            font-size: 1em;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff0050;
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5em;
        }
        
        .form-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            color: #aaa;
        }
        
        .form-switch a {
            color: #ff0050;
            cursor: pointer;
            text-decoration: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff0050;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(255, 0, 80, 0.3);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #666;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #444;
        }
        
        .video-preview {
            max-width: 100%;
            max-height: 300px;
            margin: 20px 0;
            border-radius: 10px;
            display: none;
            background: #000;
        }
        
        .user-videos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .user-video-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 9/16;
            background: #222;
            cursor: pointer;
        }
        
        .user-video-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-video-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 10px;
            font-size: 0.8em;
        }
        
        .section-title {
            margin: 20px 0;
            font-size: 1.3em;
        }
        
        .logout-btn {
            background: transparent;
            color: #ff0050;
            border: 1px solid #ff0050;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 0, 80, 0.1);
        }
        
        .video-upload-info {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #aaa;
        }
        
        .nav {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px;
            border-top: 1px solid #333;
        }
        
        .nav-item {
            text-align: center;
            font-size: 0.9em;
            opacity: 0.7;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            opacity: 1;
            color: #ff0050;
        }
        
        .nav-icon {
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Уведомления -->
        <div class="notification" id="notification"></div>
        
        <!-- Шапка -->
        <div class="header">
            <div class="logo">ClipWave</div>
        </div>
        
        <!-- Основной контент -->
        <div class="content">
            <!-- Главная лента -->
            <div class="section active" id="homeSection">
                <div class="video-feed" id="videoFeed">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h2>Пока нет видео</h2>
                        <p>Загрузите первое видео, чтобы начать просмотр</p>
                        <button class="upload-btn" onclick="showSection('uploadSection')">Загрузить видео</button>
                    </div>
                    <!-- Видео будут добавляться динамически -->
                </div>
            </div>
            
            <!-- Раздел загрузки -->
            <div class="section" id="uploadSection">
                <div class="upload-content">
                    <h2 class="section-title">Загрузить видео</h2>
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('videoUpload').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Нажмите для загрузки видео</p>
                        <p class="video-upload-info">MP4, MOV, AVI до 50MB</p>
                    </div>
                    <input type="file" id="videoUpload" accept="video/*" style="display: none" onchange="handleVideoUpload(event)">
                    
                    <video class="video-preview" id="videoPreview" controls></video>
                    
                    <input type="text" class="form-input" id="videoDescription" placeholder="Описание видео...">
                    <input type="text" class="form-input" id="videoTags" placeholder="Теги (через запятую)...">
                    <button class="upload-btn" id="uploadButton" onclick="uploadVideo()" disabled>Опубликовать видео</button>
                </div>
            </div>
            
            <!-- Профиль -->
            <div class="section" id="profileSection">
                <div class="profile-content">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 id="profileUsername">Гость</h2>
                        <p id="profileStats">0 видео • 0 лайков</p>
                    </div>
                    
                    <div class="login-form" id="loginForm">
                        <h3 class="form-title">Вход в аккаунт</h3>
                        <input type="text" class="form-input" id="loginUsername" placeholder="Имя пользователя">
                        <input type="password" class="form-input" id="loginPassword" placeholder="Пароль">
                        <button class="upload-btn" onclick="login()">Войти</button>
                        <div class="form-switch">
                            Нет аккаунта? <a onclick="showRegisterForm()">Зарегистрироваться</a>
                        </div>
                    </div>
                    
                    <div class="register-form" id="registerForm" style="display: none;">
                        <h3 class="form-title">Регистрация</h3>
                        <input type="text" class="form-input" id="registerUsername" placeholder="Имя пользователя">
                        <input type="email" class="form-input" id="registerEmail" placeholder="Email">
                        <input type="password" class="form-input" id="registerPassword" placeholder="Пароль">
                        <input type="password" class="form-input" id="registerConfirmPassword" placeholder="Подтвердите пароль">
                        <button class="upload-btn" onclick="register()">Зарегистрироваться</button>
                        <div class="form-switch">
                            Уже есть аккаунт? <a onclick="showLoginForm()">Войти</a>
                        </div>
                    </div>
                    
                    <div id="userVideos" style="display: none;">
                        <h3 class="section-title">Мои видео</h3>
                        <div class="user-videos" id="myVideosList"></div>
                        <button class="logout-btn" onclick="logout()">Выйти из аккаунта</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Навигация -->
        <div class="nav">
            <div class="nav-item active" onclick="showSection('homeSection')">
                <div class="nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div>Главная</div>
            </div>
            <div class="nav-item" onclick="showSection('uploadSection')">
                <div class="nav-icon">
                    <i class="fas fa-plus-square"></i>
                </div>
                <div>Загрузить</div>
            </div>
            <div class="nav-item" onclick="showSection('profileSection')">
                <div class="nav-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div>Профиль</div>
            </div>
        </div>
    </div>

    <script>
        // Данные приложения
        let currentUser = null;
        let videos = [];
        let currentVideoIndex = 0;
        let users = [];
        let currentVideoFile = null;
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ClipWave инициализирован");
            
            // Загружаем данные из localStorage
            loadVideosFromStorage();
            loadUsersFromStorage();
            setupEventListeners();
            showNotification('Добро пожаловать в ClipWave!');
            updateEmptyState();
            checkAuthState();
            
            // Показываем домашнюю страницу по умолчанию
            showSection('homeSection');
        });
        
        // Загрузка видео из localStorage
        function loadVideosFromStorage() {
            const savedVideos = localStorage.getItem('clipwave_videos');
            if (savedVideos) {
                videos = JSON.parse(savedVideos);
                console.log("Загружено видео:", videos.length);
                renderVideos();
            } else {
                console.log("Нет сохраненных видео");
            }
        }
        
        // Загрузка пользователей из localStorage
        function loadUsersFromStorage() {
            const savedUsers = localStorage.getItem('clipwave_users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
                console.log("Загружено пользователей:", users.length);
            } else {
                console.log("Нет сохраненных пользователей");
                // Добавляем тестового пользователя для демонстрации
                users = [
                    {
                        id: 1,
                        username: "demo",
                        email: "demo@clipwave.com", 
                        password: "demo123",
                        registeredAt: new Date().toISOString()
                    }
                ];
                saveUsersToStorage();
            }
        }
        
        // Сохранение видео в localStorage
        function saveVideosToStorage() {
            localStorage.setItem('clipwave_videos', JSON.stringify(videos));
            console.log("Видео сохранены:", videos.length);
        }
        
        // Сохранение пользователей в localStorage
        function saveUsersToStorage() {
            localStorage.setItem('clipwave_users', JSON.stringify(users));
            console.log("Пользователи сохранены:", users.length);
        }
        
        // Рендер видео
        function renderVideos() {
            const container = document.getElementById('videoFeed');
            const emptyState = document.getElementById('emptyState');
            
            if (videos.length === 0) {
                emptyState.style.display = 'flex';
                container.innerHTML = '';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            videos.forEach((video, index) => {
                const videoElement = document.createElement('div');
                videoElement.className = `video-item ${index === 0 ? 'active' : ''}`;
                videoElement.innerHTML = `
                    <video class="video-player" loop onclick="togglePlayPause(this)">
                        <source src="${video.videoUrl}" type="video/mp4">
                    </video>
                    <div class="video-controls">
                        <div class="video-info">
                            <div class="username">@${video.username}</div>
                            <div class="video-description">${video.description}</div>
                            <div class="video-tags">
                                ${video.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn like-btn ${video.liked ? 'liked' : ''}" onclick="toggleLike(${video.id})">
                                <div class="action-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <div class="action-count">${formatCount(video.likes)}</div>
                            </button>
                            <button class="action-btn" onclick="showNotification('Функция комментариев в разработке')">
                                <div class="action-icon">
                                    <i class="fas fa-comment"></i>
                                </div>
                                <div class="action-count">комменты</div>
                            </button>
                            <button class="action-btn" onclick="showNotification('Функция репоста в разработке')">
                                <div class="action-icon">
                                    <i class="fas fa-share"></i>
                                </div>
                                <div class="action-count">поделиться</div>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(videoElement);
            });
            
            // Автовоспроизведение первого видео
            setTimeout(() => {
                const firstVideo = container.querySelector('.video-item.active video');
                if (firstVideo) {
                    firstVideo.play().catch(e => {
                        console.log("Автовоспроизведение заблокировано");
                        showNotification("Нажмите на видео для воспроизведения");
                    });
                }
            }, 500);
        }
        
        // Переключение лайка
        function toggleLike(videoId) {
            if (!currentUser) {
                showNotification('Войдите в аккаунт, чтобы ставить лайки');
                return;
            }
            
            const video = videos.find(v => v.id === videoId);
            if (video) {
                video.liked = !video.liked;
                video.likes += video.liked ? 1 : -1;
                saveVideosToStorage();
                renderVideos();
                showNotification(video.liked ? 'Добавлено в понравившиеся!' : 'Лайк удален');
            }
        }
        
        // Переключение воспроизведения
        function togglePlayPause(videoElement) {
            if (videoElement.paused) {
                videoElement.play();
            } else {
                videoElement.pause();
            }
        }
        
        // Показать раздел
        function showSection(sectionId) {
            console.log("Переключение на раздел:", sectionId);
            
            // Скрываем все разделы
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Показываем выбранный раздел
            document.getElementById(sectionId).classList.add('active');
            
            // Обновить навигацию
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Активируем соответствующую кнопку навигации
            const navItems = document.querySelectorAll('.nav-item');
            if (sectionId === 'homeSection') navItems[0].classList.add('active');
            else if (sectionId === 'uploadSection') navItems[1].classList.add('active');
            else if (sectionId === 'profileSection') navItems[2].classList.add('active');
            
            // Обновить состояние пустой ленты
            if (sectionId === 'homeSection') {
                updateEmptyState();
            }
            
            // Обновить профиль при переходе в него
            if (sectionId === 'profileSection') {
                updateProfileStats();
            }
        }
        
        // Обновить состояние пустой ленты
        function updateEmptyState() {
            const emptyState = document.getElementById('emptyState');
            if (videos.length === 0) {
                emptyState.style.display = 'flex';
            } else {
                emptyState.style.display = 'none';
            }
        }
        
        // Загрузка видео
        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                console.log("Выбран файл:", file.name);
                
                // Проверяем тип файла
                if (!file.type.startsWith('video/')) {
                    showNotification('Пожалуйста, выберите видео файл');
                    return;
                }
                
                // Проверяем размер файла (50MB)
                if (file.size > 50 * 1024 * 1024) {
                    showNotification('Файл слишком большой. Максимальный размер: 50MB');
                    return;
                }
                
                // Сохраняем файл
                currentVideoFile = file;
                
                // Создаем URL для предпросмотра
                const videoUrl = URL.createObjectURL(file);
                const preview = document.getElementById('videoPreview');
                preview.src = videoUrl;
                preview.style.display = 'block';
                
                // Активируем кнопку загрузки
                document.getElementById('uploadButton').disabled = false;
                
                // Обновляем текст области загрузки
                document.getElementById('uploadArea').innerHTML = `
                    <div class="upload-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <p>Видео выбрано</p>
                    <p class="video-upload-info">${file.name}</p>
                `;
                
                showNotification(`Видео "${file.name}" готово к загрузке`);
            }
        }
        
        function uploadVideo() {
            if (!currentUser) {
                showNotification('Войдите в аккаунт, чтобы загружать видео');
                showSection('profileSection');
                return;
            }
            
            if (!currentVideoFile) {
                showNotification('Сначала выберите видео файл');
                return;
            }
            
            const description = document.getElementById('videoDescription').value;
            const tags = document.getElementById('videoTags').value;
            
            if (!description) {
                showNotification('Добавьте описание к видео');
                return;
            }
            
            // Создаем URL для видео
            const videoUrl = URL.createObjectURL(currentVideoFile);
            
            const newVideo = {
                id: Date.now(),
                username: currentUser,
                description: description,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                likes: 0,
                liked: false,
                videoUrl: videoUrl,
                timestamp: new Date().toISOString()
            };
            
            videos.unshift(newVideo);
            saveVideosToStorage();
            renderVideos();
            showSection('homeSection');
            showNotification('Видео успешно опубликовано!');
            
            // Очистить форму
            resetUploadForm();
        }
        
        // Сброс формы загрузки
        function resetUploadForm() {
            document.getElementById('videoDescription').value = '';
            document.getElementById('videoTags').value = '';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('videoPreview').src = '';
            document.getElementById('videoUpload').value = '';
            document.getElementById('uploadButton').disabled = true;
            document.getElementById('uploadArea').innerHTML = `
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <p>Нажмите для загрузки видео</p>
                <p class="video-upload-info">MP4, MOV, AVI до 50MB</p>
            `;
            
            currentVideoFile = null;
        }
        
        // Регистрация
        function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!username || !email || !password) {
                showNotification('Заполните все поля');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Пароли не совпадают');
                return;
            }
            
            if (users.find(user => user.username === username)) {
                showNotification('Пользователь с таким именем уже существует');
                return;
            }
            
            if (users.find(user => user.email === email)) {
                showNotification('Пользователь с таким email уже существует');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                username: username,
                email: email,
                password: password,
                registeredAt: new Date().toISOString()
            };
            
            users.push(newUser);
            saveUsersToStorage();
            
            // Автоматический вход после регистрации
            currentUser = username;
            updateUIAfterAuth();
            showNotification(`Добро пожаловать, ${username}!`);
            
            // Очистить форму
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
        }
        
        // Логин
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showNotification('Заполните все поля');
                return;
            }
            
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = username;
                updateUIAfterAuth();
                showNotification(`С возвращением, ${username}!`);
                
                // Очистить форму
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            } else {
                showNotification('Неверное имя пользователя или пароль');
            }
        }
        
        // Выход
        function logout() {
            currentUser = null;
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('userVideos').style.display = 'none';
            document.getElementById('profileUsername').textContent = 'Гость';
            document.getElementById('profileStats').textContent = '0 видео • 0 лайков';
            document.getElementById('profileAvatar').innerHTML = '<i class="fas fa-user"></i>';
            localStorage.removeItem('clipwave_current_user');
            showNotification('Вы вышли из аккаунта');
        }
        
        // Обновление интерфейса после авторизации
        function updateUIAfterAuth() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('userVideos').style.display = 'block';
            document.getElementById('profileUsername').textContent = currentUser;
            document.getElementById('profileAvatar').textContent = currentUser.charAt(0).toUpperCase();
            updateProfileStats();
            
            // Сохраняем текущего пользователя
            localStorage.setItem('clipwave_current_user', currentUser);
        }
        
        // Проверка состояния авторизации
        function checkAuthState() {
            const savedUser = localStorage.getItem('clipwave_current_user');
            if (savedUser) {
                currentUser = savedUser;
                updateUIAfterAuth();
            }
        }
        
        // Показать форму регистрации
        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }
        
        // Показать форму входа
        function showLoginForm() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }
        
        // Обновление статистики профиля
        function updateProfileStats() {
            if (!currentUser) return;
            
            const userVideos = videos.filter(video => video.username === currentUser);
            const totalLikes = userVideos.reduce((sum, video) => sum + video.likes, 0);
            
            document.getElementById('profileStats').textContent = 
                `${userVideos.length} видео • ${totalLikes} лайков`;
                
            // Показываем видео пользователя
            const myVideosList = document.getElementById('myVideosList');
            myVideosList.innerHTML = '';
            
            if (userVideos.length === 0) {
                myVideosList.innerHTML = '<p style="text-align:center; color:#666; grid-column:1/-1;">У вас пока нет загруженных видео</p>';
            } else {
                userVideos.forEach(video => {
                    const videoElement = document.createElement('div');
                    videoElement.className = 'user-video-item';
                    videoElement.innerHTML = `
                        <video class="user-video-thumb" onclick="playUserVideo('${video.videoUrl}')">
                            <source src="${video.videoUrl}" type="video/mp4">
                        </video>
                        <div class="user-video-info">
                            <div>${video.description.substring(0, 30)}${video.description.length > 30 ? '...' : ''}</div>
                            <div><i class="fas fa-heart" style="color:#ff0050;"></i> ${video.likes}</div>
                        </div>
                    `;
                    myVideosList.appendChild(videoElement);
                });
            }
        }
        
        // Воспроизведение видео пользователя
        function playUserVideo(videoUrl) {
            // Находим видео в основном списке
            const videoIndex = videos.findIndex(v => v.videoUrl === videoUrl);
            if (videoIndex !== -1) {
                currentVideoIndex = videoIndex;
                showSection('homeSection');
                switchVideo(currentVideoIndex);
            }
        }
        
        // Уведомления
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Форматирование чисел
        function formatCount(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Обработчики событий
        function setupEventListeners() {
            let startY = 0;
            let isSwiping = false;
            
            // Свайпы на телефоне
            document.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                isSwiping = true;
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;
                
                const currentY = e.touches[0].clientY;
                const diffY = startY - currentY;
                
                if (Math.abs(diffY) > 50) {
                    if (diffY > 0) {
                        nextVideo(); // Свайп вверх
                    } else {
                        previousVideo(); // Свайп вниз
                    }
                    isSwiping = false;
                }
            });
            
            // Клавиши на ПК
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    nextVideo();
                } else if (e.key === 'ArrowUp') {
                    previousVideo();
                } else if (e.key === ' ') {
                    e.preventDefault();
                    const currentVideo = document.querySelector('.video-item.active video');
                    if (currentVideo) togglePlayPause(currentVideo);
                }
            });
        }
        
        // Следующее видео
        function nextVideo() {
            if (currentVideoIndex < videos.length - 1) {
                currentVideoIndex++;
                switchVideo(currentVideoIndex);
            } else {
                showNotification('Это последнее видео');
            }
        }
        
        // Предыдущее видео
        function previousVideo() {
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
                switchVideo(currentVideoIndex);
            } else {
                showNotification('Это первое видео');
            }
        }
        
        // Переключение видео
        function switchVideo(index) {
            // Останавливаем текущее видео
            const currentVideo = document.querySelector('.video-item.active video');
            if (currentVideo) {
                currentVideo.pause();
            }
            
            document.querySelectorAll('.video-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const videoItems = document.querySelectorAll('.video-item');
            if (videoItems[index]) {
                videoItems[index].classList.add('active');
                const video = videoItems[index].querySelector('video');
                video.currentTime = 0;
                video.play().catch(e => {
                    console.log("Автовоспроизведение заблокировано");
                    showNotification("Нажмите на видео для воспроизведения");
                });
            }
        }
        
        // Демо-функция для быстрого тестирования
        function demoLogin() {
            document.getElementById('loginUsername').value = 'demo';
            document.getElementById('loginPassword').value = 'demo123';
            login();
        }
    </script>
</body>
</html>
